!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("THREE")):"function"==typeof define&&define.amd?define(["THREE"],t):"object"==typeof exports?exports.ThreeDxf=t(require("THREE")):e.ThreeDxf=t(e.THREE)}("undefined"!=typeof self?self:this,(function(e){return(()=>{"use strict";var t={590:(e,t,o)=>{o.r(t),o.d(t,{Viewer:()=>a});var n=o(428);function i(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new n.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var o=this,i=new n.Vector2,r=new n.Vector2,a=new n.Vector2,s=new n.Vector2,c=new n.Vector2,p=new n.Vector2,l=new n.Vector3,h=new n.Vector3,u=new n.Vector2,d=new n.Vector2,m=new n.Vector2,y=1,f=new n.Vector3,v=(new n.Vector3,-1),x=v;this.target0=this.target.clone(),this.position0=this.object.position.clone();var g={type:"change"},b={type:"start"},w={type:"end"};function E(){return 2*Math.PI/60/60*o.autoRotateSpeed}function M(){return Math.pow(.95,o.zoomSpeed)}function P(e){if(!1!==o.enabled){e.preventDefault();var t=o.domElement===document?o.domElement.body:o.domElement;if(0===x){if(!0===o.noRotate)return;r.set(e.clientX,e.clientY),a.subVectors(r,i),o.rotateLeft(2*Math.PI*a.x/t.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*a.y/t.clientHeight*o.rotateSpeed),i.copy(r)}else if(1===x){if(!0===o.noZoom)return;d.set(e.clientX,e.clientY),m.subVectors(d,u),m.y>0?o.dollyIn():o.dollyOut(),u.copy(d)}else if(2===x){if(!0===o.noPan)return;c.set(e.clientX,e.clientY),p.subVectors(c,s),o.pan(p.x,p.y),s.copy(c)}o.update()}}function L(){!1!==o.enabled&&(o.domElement.removeEventListener("mousemove",P,!1),o.domElement.removeEventListener("mouseup",L,!1),o.dispatchEvent(w),x=v)}function j(e){if(!1!==o.enabled&&!0!==o.noZoom){e.preventDefault();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?o.dollyOut():o.dollyIn(),o.update(),o.dispatchEvent(b),o.dispatchEvent(w)}}this.rotateLeft=function(e){void 0===e&&(e=E())},this.rotateUp=function(e){void 0===e&&(e=E())},this.panLeft=function(e){var t=this.object.matrix.elements;l.set(t[0],t[1],t[2]),l.multiplyScalar(-e),f.add(l)},this.panUp=function(e){var t=this.object.matrix.elements;l.set(t[4],t[5],t[6]),l.multiplyScalar(e),f.add(l)},this.pan=function(e,t){var n=o.domElement===document?o.domElement.body:o.domElement;if(void 0!==o.object.fov){var i=o.object.position.clone().sub(o.target).length();i*=Math.tan(o.object.fov/2*Math.PI/180),o.panLeft(2*e*i/n.clientHeight),o.panUp(2*t*i/n.clientHeight)}else void 0!==o.object.top?(o.panLeft(e*(o.object.right-o.object.left)/n.clientWidth),o.panUp(t*(o.object.top-o.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=M()),y/=e},this.dollyOut=function(e){void 0===e&&(e=M()),y*=e},this.update=function(){void 0!==o.object.top&&(this.object.top=y*this.object.top,this.object.bottom=y*this.object.bottom,this.object.left=y*this.object.left,this.object.right=y*this.object.right,this.object.updateProjectionMatrix());var e=this.object.position;h.copy(e).sub(this.target),this.target.add(f),e.copy(this.target).add(h),this.object.lookAt(this.target),this.dispatchEvent(g),y=1,f.set(0,0,0)},this.reset=function(){x=v,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.domElement.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),this.domElement.addEventListener("mousedown",(function(e){if(!1!==o.enabled){if(e.preventDefault(),0===e.button){if(!0===o.noRotate)return;x=0,i.set(e.clientX,e.clientY)}else if(1===e.button){if(!0===o.noZoom)return;x=1,u.set(e.clientX,e.clientY)}else if(2===e.button){if(!0===o.noPan)return;x=2,s.set(e.clientX,e.clientY)}o.domElement.addEventListener("mousemove",P,!1),o.domElement.addEventListener("mouseup",L,!1),o.dispatchEvent(b)}}),!1),this.domElement.addEventListener("mousewheel",j,!1),this.domElement.addEventListener("DOMMouseScroll",j,!1),this.domElement.addEventListener("touchstart",(function(e){if(!1!==o.enabled){switch(e.touches.length){case 1:if(!0===o.noRotate)return;x=3,i.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===o.noZoom)return;x=4;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);u.set(0,r);break;case 3:if(!0===o.noPan)return;x=5,s.set(e.touches[0].pageX,e.touches[0].pageY);break;default:x=v}o.dispatchEvent(b)}}),!1),this.domElement.addEventListener("touchend",(function(){!1!==o.enabled&&(o.dispatchEvent(w),x=v)}),!1),this.domElement.addEventListener("touchmove",(function(e){if(!1!==o.enabled){e.preventDefault(),e.stopPropagation();var t=o.domElement===document?o.domElement.body:o.domElement;switch(e.touches.length){case 1:if(!0===o.noRotate)return;if(3!==x)return;r.set(e.touches[0].pageX,e.touches[0].pageY),a.subVectors(r,i),o.rotateLeft(2*Math.PI*a.x/t.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*a.y/t.clientHeight*o.rotateSpeed),i.copy(r),o.update();break;case 2:if(!0===o.noZoom)return;if(4!==x)return;var n=e.touches[0].pageX-e.touches[1].pageX,l=e.touches[0].pageY-e.touches[1].pageY,h=Math.sqrt(n*n+l*l);d.set(0,h),m.subVectors(d,u),m.y>0?o.dollyOut():o.dollyIn(),u.copy(d),o.update();break;case 3:if(!0===o.noPan)return;if(5!==x)return;c.set(e.touches[0].pageX,e.touches[0].pageY),p.subVectors(c,s),o.pan(p.x,p.y),s.copy(c),o.update();break;default:x=v}}}),!1),window.addEventListener("keydown",(function(e){if(!1!==o.enabled&&!0!==o.noKeys&&!0!==o.noPan)switch(e.keyCode){case o.keys.UP:o.pan(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:o.pan(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:o.pan(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:o.pan(-o.keyPanSpeed,0),o.update()}}),!1)}i.prototype=Object.create(n.EventDispatcher.prototype);var r={Math:{}};function a(e,t,o,a,s){!function(e){var t,o;if(e.tables&&e.tables.lineType){var n=e.tables.lineType.lineTypes;for(o in n)(t=n[o]).pattern&&(t.material=S(t.pattern))}}(e);var c,p,l=new n.Scene,h={min:{x:!1,y:!1,z:!1},max:{x:!1,y:!1,z:!1}};for(c=0;c<e.entities.length;c++){if(p=L(e.entities[c],e)){var u=(new n.Box3).setFromObject(p);u.min.x&&(!1===h.min.x||h.min.x>u.min.x)&&(h.min.x=u.min.x),u.min.y&&(!1===h.min.y||h.min.y>u.min.y)&&(h.min.y=u.min.y),u.min.z&&(!1===h.min.z||h.min.z>u.min.z)&&(h.min.z=u.min.z),u.max.x&&(!1===h.max.x||h.max.x<u.max.x)&&(h.max.x=u.max.x),u.max.y&&(!1===h.max.y||h.max.y<u.max.y)&&(h.max.y=u.max.y),u.max.z&&(!1===h.max.z||h.max.z<u.max.z)&&(h.max.z=u.max.z),l.add(p)}p=null}var d=(o=o||t.clientWidth)/(a=a||t.clientHeight),m=h.max.x,y=h.max.y,f=h.min.x,v=h.min.y,x=m-f,g=y-v,b=b||{x:x/2+f,y:g/2+v};d>Math.abs(x/g)?x=g*d:g=x/d;var w={bottom:-g/2,left:-x/2,top:g/2,right:x/2,center:{x:b.x,y:b.y}},E=new n.OrthographicCamera(w.left,w.right,w.top,w.bottom,1,19);E.position.z=10,E.position.x=w.center.x,E.position.y=w.center.y;var M=this.renderer=new n.WebGLRenderer;M.setSize(o,a),M.setClearColor(268435455,1),t.appendChild(M.domElement),t.style.display="block";var P=new i(E,t);function L(e,t){var o;if("CIRCLE"===e.type||"ARC"===e.type)o=function(e,t){var o,i;"CIRCLE"===e.type?i=(o=e.startAngle||0)+2*Math.PI:(o=e.startAngle,i=e.endAngle);var r=new n.ArcCurve(0,0,e.radius,o,i).getPoints(32),a=(new n.BufferGeometry).setFromPoints(r),s=new n.LineBasicMaterial({color:j(e,t)}),c=new n.Line(a,s);return c.position.x=e.center.x,c.position.y=e.center.y,c.position.z=e.center.z,c}(e,t);else if("LWPOLYLINE"===e.type||"LINE"===e.type||"POLYLINE"===e.type)o=function(e,t){var o,i,a,s,c,p,l,h,u=new n.Geometry,d=j(e,t);if(!e.vertices)return console.log("entity missing vertices.");for(h=0;h<e.vertices.length;h++)e.vertices[h].bulge?(l=e.vertices[h].bulge,s=e.vertices[h],c=h+1<e.vertices.length?e.vertices[h+1]:u.vertices[0],p=new r.BulgeGeometry(s,c,l),u.vertices.push.apply(u.vertices,p.vertices)):(a=e.vertices[h],u.vertices.push(new n.Vector3(a.x,a.y,0)));return e.shape&&u.vertices.push(u.vertices[0]),e.lineType&&(i=t.tables.lineType.lineTypes[e.lineType]),o=i&&i.pattern&&0!==i.pattern.length?new n.LineDashedMaterial({color:d,gapSize:4,dashSize:4}):new n.LineBasicMaterial({linewidth:1,color:d}),new n.Line(u,o)}(e,t);else if("TEXT"===e.type)o=function(e,t){var o,i,r;if(!s)return console.warn("Text is not supported without a Three.js font loaded with THREE.FontLoader! Load a font of your choice and pass this into the constructor. See the sample for this repository or Three.js examples at http://threejs.org/examples/?q=text#webgl_geometry_text for more details.");if(o=new n.TextGeometry(e.text,{font:s,height:0,size:e.textHeight||12}),e.rotation){var a=e.rotation*Math.PI/180;o.rotateZ(a)}return i=new n.MeshBasicMaterial({color:j(e,t)}),(r=new n.Mesh(o,i)).position.x=e.startPoint.x,r.position.y=e.startPoint.y,r.position.z=e.startPoint.z,r}(e,t);else if("SOLID"===e.type)o=function(e,t){var o,i,r=new n.Geometry;(i=r.vertices).push(new n.Vector3(e.points[0].x,e.points[0].y,e.points[0].z)),i.push(new n.Vector3(e.points[1].x,e.points[1].y,e.points[1].z)),i.push(new n.Vector3(e.points[2].x,e.points[2].y,e.points[2].z)),i.push(new n.Vector3(e.points[3].x,e.points[3].y,e.points[3].z));var a=new n.Vector3,s=new n.Vector3;return a.subVectors(i[1],i[0]),s.subVectors(i[2],i[0]),a.cross(s),a.z<0?(r.faces.push(new n.Face3(2,1,0)),r.faces.push(new n.Face3(2,3,1))):(r.faces.push(new n.Face3(0,1,2)),r.faces.push(new n.Face3(1,3,2))),o=new n.MeshBasicMaterial({color:j(e,t)}),new n.Mesh(r,o)}(e,t);else if("POINT"===e.type)o=function(e,t){var o,i,r;(o=new n.Geometry).vertices.push(new n.Vector3(e.position.x,e.position.y,e.position.z));var a=j(e,t),s=new Float32Array(3);s[0]=a.r,s[1]=a.g,s[2]=a.b,o.colors=s,o.computeBoundingBox(),i=new n.PointsMaterial({size:.05,vertexColors:n.VertexColors}),r=new n.Points(o,i),l.add(r)}(e,t);else if("INSERT"===e.type)o=function(e,t){var o=t.blocks[e.name];if(!o.entities)return null;var i=new n.Object3D;e.xScale&&(i.scale.x=e.xScale),e.yScale&&(i.scale.y=e.yScale),e.rotation&&(i.rotation.z=e.rotation*Math.PI/180),e.position&&(i.position.x=e.position.x,i.position.y=e.position.y,i.position.z=e.position.z);for(var r=0;r<o.entities.length;r++){var a=L(o.entities[r],t);a&&i.add(a)}return i}(e,t);else if("SPLINE"===e.type)o=function(e,t){var o,i=j(e,t),r=e.controlPoints.map((function(e){return new n.Vector2(e.x,e.y)})),a=[];if(2===e.degreeOfSplineCurve||3===e.degreeOfSplineCurve)for(var s=0;s+2<r.length;s+=2)o=2===e.degreeOfSplineCurve?new n.QuadraticBezierCurve(r[s],r[s+1],r[s+2]):new n.QuadraticBezierCurve3(r[s],r[s+1],r[s+2]),a.push.apply(a,o.getPoints(50));else a=(o=new n.SplineCurve(r)).getPoints(100);var c=(new n.BufferGeometry).setFromPoints(a),p=new n.LineBasicMaterial({linewidth:1,color:i});return new n.Line(c,p)}(e,t);else if("MTEXT"===e.type)o=function(e,t){var o=j(e,t);if(!s)return console.log("font parameter not set. Ignoring text entity.");var i=new n.TextGeometry(e.text,{font:s,size:.8*e.height,height:1}),r=new n.MeshBasicMaterial({color:o}),a=new n.Mesh(i,r),c=new n.Box3;c.setFromObject(a);var p=c.max.x-c.min.x;if(!(p>e.width)){switch(a.position.z=0,e.attachmentPoint){case 1:a.position.x=e.position.x,a.position.y=e.position.y-e.height;break;case 2:a.position.x=e.position.x-p/2,a.position.y=e.position.y-e.height;break;case 3:a.position.x=e.position.x-p,a.position.y=e.position.y-e.height;break;case 4:a.position.x=e.position.x,a.position.y=e.position.y-e.height/2;break;case 5:a.position.x=e.position.x-p/2,a.position.y=e.position.y-e.height/2;break;case 6:a.position.x=e.position.x-p,a.position.y=e.position.y-e.height/2;break;case 7:a.position.x=e.position.x,a.position.y=e.position.y;break;case 8:a.position.x=e.position.x-p/2,a.position.y=e.position.y;break;case 9:a.position.x=e.position.x-p,a.position.y=e.position.y;break;default:return}return a}console.log("Can't render this multipline MTEXT entity, sorry.",e)}(e,t);else if("ELLIPSE"===e.type)o=function(e,t){var o=j(e,t),i=Math.sqrt(Math.pow(e.majorAxisEndPoint.x,2)+Math.pow(e.majorAxisEndPoint.y,2)),r=i*e.axisRatio,a=Math.atan2(e.majorAxisEndPoint.y,e.majorAxisEndPoint.x),s=new n.EllipseCurve(e.center.x,e.center.y,i,r,e.startAngle,e.endAngle,!1,a).getPoints(50),c=(new n.BufferGeometry).setFromPoints(s),p=new n.LineBasicMaterial({linewidth:1,color:o});return new n.Line(c,p)}(e,t);else if("DIMENSION"===e.type){var i=7&e.dimensionType;0===i?o=function(e,t){var o=t.blocks[e.block];if(!o||!o.entities)return null;for(var i=new n.Object3D,r=0;r<o.entities.length;r++){var a=L(o.entities[r],t);a&&i.add(a)}return i}(e,t):console.log("Unsupported Dimension type: "+i)}else console.log("Unsupported Entity Type: "+e.type);return o}function j(e,t){var o=0;return e.color?o=e.color:t.tables&&t.tables.layer&&t.tables.layer.layers[e.layer]&&(o=t.tables.layer.layers[e.layer].color),null!=o&&16777215!==o||(o=0),o}function S(e){var t,o={},i=0;for(t=0;t<e.length;t++)i+=Math.abs(e[t]);return o.uniforms=n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,{pattern:{type:"fv1",value:e},patternLength:{type:"f",value:i}}]),o.vertexShader=["attribute float lineDistance;","varying float vLineDistance;",n.ShaderChunk.color_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"vLineDistance = lineDistance;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),o.fragmentShader=["uniform vec3 diffuse;","uniform float opacity;","uniform float pattern["+e.length+"];","uniform float patternLength;","varying float vLineDistance;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.fog_pars_fragment,"void main() {","float pos = mod(vLineDistance, patternLength);","for ( int i = 0; i < "+e.length+"; i++ ) {","pos = pos - abs(pattern[i]);","if( pos < 0.0 ) {","if( pattern[i] > 0.0 ) {","gl_FragColor = vec4(1.0, 0.0, 0.0, opacity );","break;","}","discard;","}","}",n.ShaderChunk.color_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n"),o}P.target.x=E.position.x,P.target.y=E.position.y,P.target.z=0,P.zoomSpeed=3,this.render=function(){M.render(l,E)},P.addEventListener("change",this.render),this.render(),P.update(),this.resize=function(e,t){var o=e/M.domElement.width,n=t/M.domElement.height;E.top=n*E.top,E.bottom=n*E.bottom,E.left=o*E.left,E.right=o*E.right,M.setSize(e,t),M.setClearColor(268435455,1),this.render()}}r.Math.angle2=function(e,t){var o=new n.Vector2(e.x,e.y),i=new n.Vector2(t.x,t.y);return i.sub(o),i.normalize(),i.y<0?-Math.acos(i.x):Math.acos(i.x)},r.Math.polar=function(e,t,o){var n={};return n.x=e.x+t*Math.cos(o),n.y=e.y+t*Math.sin(o),n},r.BulgeGeometry=function(e,t,o,i){var a,s,c,p,l,h,u,d,m;for(n.Geometry.call(this),this.startPoint=p=e?new n.Vector2(e.x,e.y):new n.Vector2(0,0),this.endPoint=l=t?new n.Vector2(t.x,t.y):new n.Vector2(1,0),this.bulge=o=o||1,h=4*Math.atan(o),u=p.distanceTo(l)/2/Math.sin(h/2),c=r.Math.polar(e,u,r.Math.angle2(p,l)+(Math.PI/2-h/2)),this.segments=i=i||Math.max(Math.abs(Math.ceil(h/(Math.PI/18))),6),d=r.Math.angle2(c,p),m=h/i,this.vertices.push(new n.Vector3(p.x,p.y,0)),s=1;s<=i-1;s++)a=r.Math.polar(c,Math.abs(u),d+m*s),this.vertices.push(new n.Vector3(a.x,a.y,0))},r.BulgeGeometry.prototype=Object.create(n.Geometry.prototype)},428:t=>{t.exports=e}},o={};function n(e){if(o[e])return o[e].exports;var i=o[e]={exports:{}};return t[e](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(590)})()}));